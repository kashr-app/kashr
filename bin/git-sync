#!/bin/bash
# Sync local main branch after PR merge

set -e

CURRENT_BRANCH=$(git branch --show-current)

if [ "$CURRENT_BRANCH" != "main" ]; then
    echo "→ Switching to main branch..."
    git checkout main
fi

echo "→ Fetching updates and pruning deleted remote branches..."
git fetch --prune

echo "→ Fast-forward merging origin/main..."
if git merge --ff-only origin/main; then
    echo "✓ Done! Local main is up to date."
else
    echo "✗ Fast-forward merge failed!"
    echo "  This means your local main has diverged from origin/main."
    echo "  You may need to resolve this manually."
    exit 1
fi
